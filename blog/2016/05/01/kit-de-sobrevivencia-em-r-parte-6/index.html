


<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Kit De Sobrevivência Em R - Parte 6: Estruturas De Controle - Full Join</title>
  <meta name="author" content="Full Join">

  
  <meta name="description" content="Kit De Sobrevivência Em R - Parte 6: Estruturas De Controle 01/05/2016 8:04 pm | básico, introdução ao r, r No último post, você aprendeu um pouco &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://fulljoin.com.br/blog/2016/05/01/kit-de-sobrevivencia-em-r-parte-6/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Full Join" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!-- MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript"
   src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-75406624-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>


<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Full Join</a></h1>
  
    <h2>Análise de Dados de um jeito fácil.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="fulljoin.com.br">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Arquivo</a></li>
  <li><a href="/authors">Sobre</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Kit De Sobrevivência Em R - Parte 6: Estruturas De Controle</h1>
        
          
    <p class="meta">
    




<time class='entry-date' datetime='2016-05-01T20:04:00-03:00'><span class='date'>01/05/2016</span> <span class='time'>8:04 pm</span></time>
        
        | 

<span class="categories">
  
    <a class='category' href='/blog/categories/basico/'>básico</a>, <a class='category' href='/blog/categories/introducao-ao-r/'>introdução ao r</a>, <a class='category' href='/blog/categories/r/'>r</a>
  
</span>


      </p>
    
  </header>


<div class="entry-content"><p>No último post, você aprendeu um pouco sobre os tipos de dados e como realizar algumas transformações. Neste post, trataremos um pouco sobre estruturas de controles (for, if, else, while etc.). Estruturas de controles serão bastante usadas durante o processo de análise de dados, sendo importante que você domine esse tópico.</p>

<!-- More -->

<p>Para exemplificar, utilizaremos os dados de taxas de desemprego que estão disponíveis <a href="https://www.dropbox.com/s/4tedgnkd85c5q5s/desemprego_uf_pnad.zip?dl=0">neste link</a>.</p>

<p>Antes de mais nada, carregue os dados:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">desemprego.uf</span> <span class="o">&lt;-</span> <span class="n">read.table</span><span class="p">(</span><span class="s2">"desemprego_uf_espaco.txt"</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">" "</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="s2">","</span><span class="p">,</span> <span class="n">stringsAsFactors</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span></code></pre></div>

<h1 id="intuio-sobre-loops">Intuição sobre Loops</h1>

<p>Trata-se de um dos conceitos mais importantes de qualquer linguagem de programação. Em R não é diferente. Loops (ou laços) repetem uma sequência de comando quantas vezes você desejar, ou até que uma condição aconteça, variando alguns aspectos entre uma repetição e outra.</p>

<p>Supondo que você queira testar uma simples expressão para 5 valores diferentes, por exemplo:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">x</span> <span class="o">&lt;-</span> <span class="m">2</span>
<span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="m">2</span> <span class="o">+</span> <span class="n">x</span><span class="o">^</span><span class="m">2</span> <span class="o">+</span> <span class="n">x</span><span class="o">^</span><span class="n">x</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## [1] 14</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">x</span> <span class="o">&lt;-</span> <span class="m">3</span>
<span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="m">2</span> <span class="o">+</span> <span class="n">x</span><span class="o">^</span><span class="m">2</span> <span class="o">+</span> <span class="n">x</span><span class="o">^</span><span class="n">x</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## [1] 45</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">x</span> <span class="o">&lt;-</span> <span class="m">4</span>
<span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="m">2</span> <span class="o">+</span> <span class="n">x</span><span class="o">^</span><span class="m">2</span> <span class="o">+</span> <span class="n">x</span><span class="o">^</span><span class="n">x</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## [1] 284</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">x</span> <span class="o">&lt;-</span> <span class="m">5</span>
<span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="m">2</span> <span class="o">+</span> <span class="n">x</span><span class="o">^</span><span class="m">2</span> <span class="o">+</span> <span class="n">x</span><span class="o">^</span><span class="n">x</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## [1] 3165</code></pre></div>

<p>Repare que você executou 5 vezes o mesmo comando alterando apenas o valor da variável <code>x</code>. 5 ainda parece uma quantidade pequena, mas vamos supor que você gostaria de testar essa expressão para 1000 valores? Você a escreveria 1000 vezes? Apesar de você poder calcular todos esses valores a partir de um vetor <code>x &lt;- 2:5</code>, em uma situação específica você pode ser ver obrigado a usar um loop pra não ter que ficar fazendo repetições cansativas.</p>

<h2 id="for">for()</h2>

<p>O <code>for()</code> é usado para realizar uma série de ordens para uma determinada sequência ou índices. Aplicando ao exemplo acima, temos a seguinte sintaxe:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="k">for</span><span class="p">(</span><span class="n">x</span> <span class="k">in</span> <span class="m">2</span><span class="o">:</span><span class="m">5</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">print</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="m">2</span> <span class="o">+</span> <span class="n">x</span><span class="o">^</span><span class="m">2</span> <span class="o">+</span> <span class="n">x</span><span class="o">^</span><span class="n">x</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## [1] 14
## [1] 45
## [1] 284
## [1] 3165</code></pre></div>

<p>Repare, você escreveu bem menos e o resultado foi idêntico: “para cada <code>x</code> igual a cada item na sequência <code>2:5</code>, execute <code>print(x + x*2 + x^2 + x^x)</code>”. O <code>for()</code> irá repetir todas as instruções dentro das chaves <code>{ }</code> para cada elemento da sua sequência (vetor).</p>

<p>Você também pode passar números que poderão ser usados como índices.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">x</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">){</span>
  <span class="n">print</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="p">}</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## [1] 1
## [1] 4
## [1] 5
## [1] 6
## [1] 10</code></pre></div>

<p>Vamos a um exemplo mais útil que deixa mais claro como o <code>for()</code> funciona. Suponha que você necessita gerar um único plot com quatro gráficos, um para cada trimestre de 2015, da taxa de desemprego por unidade da federação.</p>

<p>Para facilitar, iremos criar um novo data.frame em que estejam selecionadas somente as linhas em que a variável ano é igual a 2015:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">desemprego.uf.2015</span> <span class="o">&lt;-</span> <span class="n">desemprego.uf</span><span class="p">[</span><span class="n">desemprego.uf</span><span class="o">$</span><span class="n">Ano</span> <span class="o">==</span> <span class="m">2015</span><span class="p">,]</span></code></pre></div>

<p>Perceba que no código base do R, para selecionar as linhas de um data.frame, você utiliza o <code>[ , ]</code>. A vírgula divide as duas dimensões do data.frame. Assim, se o desejo é selecionar linhas, são utilizadas condições antes da vírgula. Para selecionar colunas, serão necessários códigos após a vírgula. Funciona de maneira similar a uma matriz.</p>

<p>No entanto, esta não é a única maneira de realizar esse filtro nos dados. Por exemplo, você poderia obter o mesmo resultado usando a função <code>subset()</code>. Dê uma olhadinha no help.</p>

<p>Além disso, iremos criar um vetor com os trimestres que serão usados como base para realização do loop.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Selecionar valores únicos da coluna Trimestre</span>
<span class="n">trimestre</span> <span class="o">&lt;-</span> <span class="n">unique</span><span class="p">(</span><span class="n">desemprego.uf.2015</span><span class="o">$</span><span class="n">Trimestre</span><span class="p">)</span>
<span class="n">trimestre</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## [1] jan-fev-mar abr-mai-jun jul-ago-set out-nov-dez
## Levels: abr-mai-jun jan-fev-mar jul-ago-set out-nov-dez</code></pre></div>

<p>Vamos treinar o <code>for()</code> exibindo todos os valores da variável <code>trimestre</code>.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">trimestre</span><span class="p">){</span>
  <span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## [1] "jan-fev-mar"
## [1] "abr-mai-jun"
## [1] "jul-ago-set"
## [1] "out-nov-dez"</code></pre></div>

<p>Agora vamos definir alguns parâmetros do plot. Aqui usaremos o recurso base do R para geração dos gráficos. Atualmente, uma boa parte dos usuários (inclusive a gente) utiliza o <a href="http://docs.ggplot2.org/current/">ggplot2</a>.</p>

<p>Com um pouco de criatividade e com uma boa base de dados, você poderá criar gráficos como o que está <a href="https://medium.com/airbnb-engineering/using-r-packages-and-education-to-scale-data-science-at-airbnb-906faa58e12d#.z39ukskpb">neste post</a> do Airbnb. Não entraremos em detalhes sobre gráficos agora, mas prometemos uma sequência de posts ensinando todos os principais aspectos da confecção de gráficos, aguarde!</p>

<p>Os parâmetros do plot serão definidos usando a função <code>par()</code>. Utilize o <code>?par</code> para ver mais detalhes sobre esta função e as opções disponíveis.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">),</span> <span class="c1"># O plot terá 2 linhas e 2 colunas</span>
    <span class="n">mar</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="m">8</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> <span class="c1"># margens inferior, esquerda, superior, direita</span>
    <span class="n">las</span> <span class="o">=</span> <span class="m">2</span><span class="p">)</span> <span class="c1"># rótulos perpendicular aos eixos</span></code></pre></div>

<p>O código abaixo traz o loop. Temos 4 operações dentro do loop:</p>

<ul>
  <li>Criar o data.frame <code>dados.tmp</code> a partir de um filtro no data.frame <code>desemprego.uf.2015</code>. Queremos somente as linhas em que o Trimestre é igual a <code>i</code>.</li>
  <li>Usando a função <code>order()</code>, ordenar as linhas dos <code>dados.tmp</code> de forma decrescente pelo valor da taxa de desemprego. Vide <code>?order()</code>.</li>
  <li>Criar um objeto de texto que trará o título de cada gráfico. Usamos a função <code>paste()</code> que tem o papel de concatenar o que for passado como argumento. Usamos espaço como separador, mas você pode passar qualquer separador entre as aspas. Esta função tem mais um parâmetro: <code>collapse</code>. Não precisaremos desse parâmetro aqui, mas dê uma olhada no help para ver alguns exemplos. Note também que ele já tem um valor padrão <code>NULL</code>.</li>
  <li>Por fim, usamos o <code>barplot()</code> para criar o gráfico de barra. Vide <code>?barplot()</code>.</li>
</ul>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">trimestre</span><span class="p">){</span>
  <span class="n">dados.tmp</span> <span class="o">&lt;-</span> <span class="n">desemprego.uf.2015</span><span class="p">[</span><span class="n">desemprego.uf.2015</span><span class="o">$</span><span class="n">Trimestre</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span>
                                  <span class="n">c</span><span class="p">(</span><span class="s1">'UF'</span><span class="p">,</span> <span class="s1">'Taxa_Desemprego'</span><span class="p">)]</span>
  <span class="n">dados.tmp</span> <span class="o">&lt;-</span> <span class="n">dados.tmp</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">dados.tmp</span><span class="o">$</span><span class="n">Taxa_Desemprego</span><span class="p">,</span> <span class="n">decreasing</span> <span class="o">=</span> <span class="n">T</span><span class="p">),]</span>
  <span class="c1"># Cria o título do plot</span>
  <span class="n">title</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="s2">"Taxa de Desemprego 2015:"</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">" "</span><span class="p">)</span>
  <span class="c1"># Gera o gráfico de barras</span>
  <span class="n">barplot</span><span class="p">(</span><span class="n">dados.tmp</span><span class="o">$</span><span class="n">Taxa_Desemprego</span><span class="p">,</span> <span class="n">names.arg</span> <span class="o">=</span> <span class="n">dados.tmp</span><span class="o">$</span><span class="n">UF</span><span class="p">,</span>
          <span class="n">col</span> <span class="o">=</span> <span class="s2">"dodgerblue"</span><span class="p">,</span> <span class="n">border</span> <span class="o">=</span> <span class="n">NA</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span>
          <span class="n">ylab</span><span class="o">=</span><span class="s2">"%"</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>

<p>Veja o resultado:</p>

<p><img src="/figures/source/2016-05-01-kit-de-sobrevivencia-em-r-parte-6/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" /></p>

<p>O gif abaixo mostra como o R vai inserindo gráfico a gráfico. Adicionei o comando <code>Sys.sleep()</code> para que a execução fosse suspensa durante 1,5 segundo para ficar mais claro a criação de cada gráfico e ter a sensação do loop criando um por um (na realidade isso acontece quase instantaneamente!).</p>

<p><img src="/images/forloop.gif" alt="alt Usando o for" title="Usando o for" /></p>

<h2 id="if-e-else">if e else</h2>

<p>Outro clássico conceito de programação que você usará muito é o if e else. É uma estrutura condicional, que usa os operadores lógicos apresentados <a href="/blog/2016/04/21/kit-de-sobrevivencia-em-r-parte-5/">no post anterior</a>. Se a condição do <code>if()</code> for verdadeira, executa os comandos dentro das chaves <code>{ }</code>, se for falsa, executa os comando da chave do <code>else { }</code></p>

<p>Para exemplificar o uso do if e else, vamos continuar com o exemplo anterior, mas desta vez queremos que as barras para o trimestre <code>out-nov-dez</code> sejam vermelhas. Dessa forma, usaremos os controles if e else. A ideia é realizar um teste sobre <code>i</code> que assume um valor do vetor <code>trimestre</code>. Assim, se <code>i</code> for igual a <code>out-nov-dez</code>, a cor será ver vermelha (<code>col = red</code>), caso contrário utilizaremos o azul (<code>col = dodgerblue</code>).</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">),</span> <span class="c1"># O plot terá 2 linas e 2 colunas</span>
    <span class="n">mar</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> <span class="c1"># margens inferior, esquerda, superior, direita</span>
    <span class="n">las</span> <span class="o">=</span> <span class="m">2</span><span class="p">)</span> <span class="c1"># rótulos perpendicular aos eixos</span>
<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">trimestre</span><span class="p">){</span>
  <span class="n">dados.tmp</span> <span class="o">&lt;-</span> <span class="n">desemprego.uf.2015</span><span class="p">[</span><span class="n">desemprego.uf.2015</span><span class="o">$</span><span class="n">Trimestre</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span>
                                  <span class="n">c</span><span class="p">(</span><span class="s1">'UF'</span><span class="p">,</span> <span class="s1">'Taxa_Desemprego'</span><span class="p">)]</span>
  <span class="n">dados.tmp</span> <span class="o">&lt;-</span> <span class="n">dados.tmp</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">dados.tmp</span><span class="o">$</span><span class="n">Taxa_Desemprego</span><span class="p">,</span> <span class="n">decreasing</span> <span class="o">=</span> <span class="n">T</span><span class="p">),]</span>
  <span class="n">title</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="s2">"Taxa de Desemprego 2015:"</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">" "</span><span class="p">)</span>
  <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="s1">'out-nov-dez'</span><span class="p">){</span>
    <span class="n">barplot</span><span class="p">(</span><span class="n">dados.tmp</span><span class="o">$</span><span class="n">Taxa_Desemprego</span><span class="p">,</span> <span class="n">names.arg</span> <span class="o">=</span> <span class="n">dados.tmp</span><span class="o">$</span><span class="n">UF</span><span class="p">,</span>
          <span class="n">col</span> <span class="o">=</span> <span class="s2">"red"</span><span class="p">,</span> <span class="n">border</span> <span class="o">=</span> <span class="n">NA</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span>
          <span class="n">ylab</span><span class="o">=</span><span class="s2">"%"</span><span class="p">)</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
     <span class="n">barplot</span><span class="p">(</span><span class="n">dados.tmp</span><span class="o">$</span><span class="n">Taxa_Desemprego</span><span class="p">,</span> <span class="n">names.arg</span> <span class="o">=</span> <span class="n">dados.tmp</span><span class="o">$</span><span class="n">UF</span><span class="p">,</span>
          <span class="n">col</span> <span class="o">=</span> <span class="s2">"dodgerblue"</span><span class="p">,</span> <span class="n">border</span> <span class="o">=</span> <span class="n">NA</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span>
          <span class="n">ylab</span><span class="o">=</span><span class="s2">"%"</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p><img src="/figures/source/2016-05-01-kit-de-sobrevivencia-em-r-parte-6/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12" /></p>

<p>Podemos reescrever o código acima com o comando <code>ifelse()</code> e obter o mesmo resultado (veja <code>?ifelse()</code>). Para isso, iremos usar o comando <code>ifelse()</code> no argumento <code>col</code>. O primeiro argumento dessa função é o teste que você deseja realizar (saber se o trimestre é ou não é igual a <code>out-nov-dez</code>), o segundo é o valor desejado caso seja verdade e o último é o valor a ser retornado caso a condição não seja satisfeita.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">),</span> <span class="c1"># O plot terá 2 linas e 2 colunas</span>
    <span class="n">mar</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> <span class="c1"># margens inferior, esquerda, superior, direita</span>
    <span class="n">las</span> <span class="o">=</span> <span class="m">2</span><span class="p">)</span> <span class="c1"># rótulos perpendicular aos eixos</span>
<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">trimestre</span><span class="p">){</span>
  <span class="n">dados.tmp</span> <span class="o">&lt;-</span> <span class="n">desemprego.uf.2015</span><span class="p">[</span><span class="n">desemprego.uf.2015</span><span class="o">$</span><span class="n">Trimestre</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span>
                                  <span class="n">c</span><span class="p">(</span><span class="s1">'UF'</span><span class="p">,</span> <span class="s1">'Taxa_Desemprego'</span><span class="p">)]</span>
  <span class="n">dados.tmp</span> <span class="o">&lt;-</span> <span class="n">dados.tmp</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">dados.tmp</span><span class="o">$</span><span class="n">Taxa_Desemprego</span><span class="p">,</span> <span class="n">decreasing</span> <span class="o">=</span> <span class="n">T</span><span class="p">),]</span>
  <span class="n">title</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="s2">"Taxa de Desemprego 2015:"</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">" "</span><span class="p">)</span>
  <span class="n">barplot</span><span class="p">(</span><span class="n">dados.tmp</span><span class="o">$</span><span class="n">Taxa_Desemprego</span><span class="p">,</span> <span class="n">names.arg</span> <span class="o">=</span> <span class="n">dados.tmp</span><span class="o">$</span><span class="n">UF</span><span class="p">,</span>
          <span class="n">col</span> <span class="o">=</span> <span class="n">ifelse</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="s1">'out-nov-dez'</span><span class="p">,</span> <span class="s1">'red'</span><span class="p">,</span> <span class="s1">'dodgerblue'</span><span class="p">),</span>
          <span class="n">border</span> <span class="o">=</span> <span class="n">NA</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span>
          <span class="n">ylab</span><span class="o">=</span><span class="s2">"%"</span><span class="p">)</span>
  
<span class="p">}</span></code></pre></div>

<p><img src="/figures/source/2016-05-01-kit-de-sobrevivencia-em-r-parte-6/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13" /></p>

<p>O <code>ifelse()</code> tem uma característica importante. Enquanto o <code>if()</code> aceita apenas um único teste (comprimento um), o <code>ifelse</code> pode receber um vetor para testes e aplicar as condições para este conjunto de teste. Para ficar mais claro veja o exemplo abaixo.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">desemprego.uf.2015</span><span class="o">$</span><span class="n">Maior.que.9</span> <span class="o">&lt;-</span> <span class="n">ifelse</span><span class="p">(</span><span class="n">desemprego.uf.2015</span><span class="o">$</span><span class="n">Taxa_Desemprego</span> <span class="o">&gt;</span> <span class="m">9</span><span class="p">,</span>
                                         <span class="s2">"Maior que 9"</span><span class="p">,</span>
                                         <span class="s2">"Menor ou igual a 9"</span><span class="p">)</span>
<span class="n">head</span><span class="p">(</span><span class="n">desemprego.uf.2015</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##     Ano   Trimestre       UF Taxa_Desemprego        Maior.que.9
## 13 2015 jan-fev-mar Rondônia           4.396 Menor ou igual a 9
## 14 2015 abr-mai-jun Rondônia           4.919 Menor ou igual a 9
## 15 2015 jul-ago-set Rondônia           6.679 Menor ou igual a 9
## 16 2015 out-nov-dez Rondônia           6.276 Menor ou igual a 9
## 29 2015 jan-fev-mar     Acre           8.722 Menor ou igual a 9
## 30 2015 abr-mai-jun     Acre           8.723 Menor ou igual a 9
## 31 2015 jul-ago-set     Acre           8.759 Menor ou igual a 9
## 32 2015 out-nov-dez     Acre           7.588 Menor ou igual a 9
## 45 2015 jan-fev-mar Amazonas           9.358        Maior que 9
## 46 2015 abr-mai-jun Amazonas           9.457        Maior que 9</code></pre></div>

<h2 id="while-repeat-break-next">while, repeat, break, next</h2>

<p>Além do <code>for()</code>, temos também outras estruturas de loop que funcionam de maneira semelhante, mudando somente a condição para execução das repetições.</p>

<p>O <code>while()</code> é uma estrutura de controle utilizada para realizar um loop enquanto uma condição for satisfeita. Aqui realizaremos um loop simples somente para demonstrar o funcionamento do <code>while()</code>. Será criado um objeto <code>i</code> igual a 1 e iremos mostrá-lo no console enquanto for menor ou igual a 5. A cada iteração será adicionado 1 ao valor de <code>i</code>.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">i</span> <span class="o">&lt;-</span> <span class="m">1</span>
<span class="k">while</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="m">5</span><span class="p">){</span>
  <span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
  <span class="n">i</span> <span class="o">&lt;-</span> <span class="n">i</span> <span class="o">+</span> <span class="m">1</span>
<span class="p">}</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5</code></pre></div>

<p>Como você notou no exemplo do <code>if</code> e <code>else</code>, o R permite que um loop seja elaborado com várias estruturas de controle. Usaremos isto para exemplificar o funcionamento do <code>repeat</code> e do <code>break</code>.</p>

<p>O <code>repeat</code> realiza as operações que estão entre <code>{ }</code> indefinidamente. Obviamente, não iremos querer executar nada para sempre, iremos querer que o loop termine caso alguma coisa aconteça. Dessa forma, temos que criar uma condição para que ele pare e uma instrução dizendo que o loop deve terminar caso a condição seja satisfeita.</p>

<p>No exemplo abaixo, iremos novamente incrementar o objeto <code>i</code>, mas queremos que estas operações parem se ele superar 6, ou seja, no meio da execução vamos verificar se a condição de parada acontece. Veja o código abaixo:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">i</span> <span class="o">&lt;-</span> <span class="m">1</span>
<span class="k">repeat</span><span class="p">{</span>
  <span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
  <span class="n">i</span> <span class="o">&lt;-</span> <span class="n">i</span> <span class="o">+</span> <span class="m">1</span>
  <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="m">6</span><span class="p">){</span>
    <span class="k">break</span> <span class="c1"># Se a condição é satisfeita, encerra o loop.</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6</code></pre></div>

<p>Por fim, o <code>next</code> é usado para pular para a próxima iteração caso uma determinada condição seja satisfeita. É muito usado quando você quer ignorar certas repetições, por exemplo:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="m">2</span> <span class="o">&amp;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="m">4</span><span class="p">)</span> <span class="k">next</span>
  <span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## [1] 1
## [1] 2
## [1] 5
## [1] 6
## [1] 7
## [1] 8
## [1] 9
## [1] 10</code></pre></div>

<p>Perceba que não há necessidade das <code>{ }</code> se a operação a ser executada em um estrutura de controle estiver na mesma linha. Você também poderia usar normalmente o <code>{ }</code>.</p>

<h2 id="algumas-observaes">Algumas observações</h2>

<p>Muitas operações que usam loops podem ser realizadas a partir de outros comandos de maneira mais rápida (família <code>apply()</code>, por exemplo). Os loops no R são conhecidos por serem lentos e dependendo do seu problema eles se tornam inviáveis. No entanto, existem algumas práticas que tornam os loops mais rápidos. Não iremos tratar disso por agora, mas aqueles que tiverem mais curiosidade podem encontrar mais informações <a href="https://www.datacamp.com/community/tutorials/tutorial-on-loops-in-r">aqui</a>.</p>

<h2 id="desafio">Desafio</h2>

<p>Fugindo um pouco dos exemplos dos gráficos, vamos lançar um desafio em relação ao método de <a href="https://pt.wikipedia.org/wiki/M%C3%A9todo_de_Newton-Raphson">Newton-Raphson</a> para que seja encontrada a raiz de uma determinada função. O método consiste em um processo iterativo em que a cada período o valor da variável é atualizado de acordo com uma fórmula e há convergência quando o valor absoluto da função para aquele determinado é inferior a um nível de tolerância.</p>

<p>O objetivo é encontrar a raiz da função:
<script type="math/tex">f(x) = x^3 - 2x - 6</script></p>

<p>Partindo de um valor inicial, o processo de iteração é o seguinte:</p>

<script type="math/tex; mode=display">x_{n+1} = x_n - \frac{f(x_n)}{f'(x_n)} = x_n - \frac{x_n^3 - 2x_n - 6}{3x_n^2 - 2}</script>

<p>Use como critério de parada se $|f(x_n)| &lt; 0.000001$ e como valor inicial $x_0 = -10$.</p>

<h2 id="referncias">Referências</h2>

<ul>
  <li><a href="http://datascienceplus.com/how-to-write-the-loop-in-r/">How to write the first for loop in R</a></li>
  <li><a href="http://rforpublichealth.blogspot.com.br/2013/01/for-loops-and-how-to-avoid-them.html">For loops (and how to avoid them)</a></li>
  <li><a href="http://stackoverflow.com/questions/2908822/speed-up-the-loop-operation-in-r">Speed up the loop operation in R</a></li>
</ul>

<h2 id="demais-posts-da-sequncia">Demais posts da sequência:</h2>

<ul>
  <li><a href="/blog/2016/03/23/kit-de-sobrevivencia-em-r-parte-1">Kit de sobrevivência em R - Parte 1: Visão Geral e Instalação</a></li>
  <li><a href="/blog/2016/04/03/kit-de-sobrevivencia-em-r-parte-2">Kit de sobrevivência em R - Parte 2: Operações, Variáveis e Funções</a></li>
  <li><a href="/blog/2016/04/03/kit-de-sobrevivencia-em-r-parte-3">Kit de sobrevivência em R - Parte 3: Pacotes</a></li>
  <li><a href="/blog/2016/04/12/kit-de-sobrevivencia-em-r-parte-4">Kit de sobrevivência em R - Parte 4: Carregando Dados</a></li>
  <li><a href="/blog/2016/04/21/kit-de-sobrevivencia-em-r-parte-5">Kit de sobrevivência em R - Parte 5: Tipos de Dados e Transformações</a></li>
  <li><a href="/blog/2016/05/01/kit-de-sobrevivencia-em-r-parte-6">Kit de sobrevivência em R - Parte 6: Estruturas de Controle</a></li>
  <li><a href="/blog/2016/05/09/kit-de-sobrevivencia-em-r-parte-7">Kit de sobrevivência em R - Parte 7: Avançando e Aprofundando</a></li>
</ul>
</div>


  <p class="meta" style="text-align:center">
    <i>Tem alguma dúvida, crítica ou sugestão? Deixe o seu comentário! Ficaremos felizes em ajudar.<i>
  </p>
  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Postado por <span class="fn">Full Join</span></span>

      




<time class='entry-date' datetime='2016-05-01T20:04:00-03:00'><span class='date'>01/05/2016</span> <span class='time'>8:04 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/basico/'>básico</a>, <a class='category' href='/blog/categories/introducao-ao-r/'>introdução ao r</a>, <a class='category' href='/blog/categories/r/'>r</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://fulljoin.com.br/blog/2016/05/01/kit-de-sobrevivencia-em-r-parte-6/" data-via="" data-counturl="http://fulljoin.com.br/blog/2016/05/01/kit-de-sobrevivencia-em-r-parte-6/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>
<br/>
    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2016/04/21/kit-de-sobrevivencia-em-r-parte-5/" title="Previous Post: Kit de sobrevivência em R - Parte 5: Tipos de dados e transformações">&laquo; Kit de sobrevivência em R - Parte 5: Tipos de dados e transformações</a>
      
      
        <a class="basic-alignment right" href="/blog/2016/05/09/kit-de-sobrevivencia-em-r-parte-7/" title="Next Post: Kit de sobrevivência em R - Parte 7: Avançando e Aprofundando">Kit de sobrevivência em R - Parte 7: Avançando e Aprofundando &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comentários</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/08/16/manipulacao-de-dados-parte-1/">Manipulação De Dados - Parte 1: Dplyr Básico</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/07/30/comex-vis/">Comex Vis E a Visualização De Dados No Brasil</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/07/10/intro-modelos-r/">Introdução a Modelos No R</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/25/tudo-sobre-joins/">Tudo Sobre Joins (Merge) Em R</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/09/kit-de-sobrevivencia-em-r-parte-7/">Kit De Sobrevivência Em R - Parte 7: Avançando E Aprofundando</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Full Join -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'fulljoin';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://fulljoin.com.br/blog/2016/05/01/kit-de-sobrevivencia-em-r-parte-6/';
        var disqus_url = 'http://fulljoin.com.br/blog/2016/05/01/kit-de-sobrevivencia-em-r-parte-6/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v2.6&appId=311389362316252";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>




  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





<script>
function addBlankTargetForLinks () {
  $('a[href^="http"]').each(function(){
		$(this).attr('target', '_blank');
	});
}

$(document).bind('DOMNodeInserted', function(event) {
	addBlankTargetForLinks();
});
</script>

</body>
</html>
